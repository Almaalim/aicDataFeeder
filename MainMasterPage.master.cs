using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;

public partial class MainMasterPage : System.Web.UI.MasterPage
{
    AppUsersPro AppPro = new AppUsersPro();
    AppUsersSql AppSql = new AppUsersSql();

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public static string Titel = "";
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    protected void Page_Load(object sender, EventArgs e)
    {
        FormSession.FillSession("", null);

        try { Response.AppendHeader("Refresh", Convert.ToString((Session.Timeout * 60) + 2) + "; URL=../Login.aspx"); }
        catch (Exception ex) { }

        if (FormSession.Language == "Ar") { MainDiv.Attributes.Add("dir", "rtl"); } else { MainDiv.Attributes.Add("dir", "ltr"); }

        int Index = InfoTab.FindPageIndex(FormSession.PageIndex);
        InfoTab.ShowTabs(Index, Session["Language"].ToString(), (HtmlTableCell)MyHeader.FindControl("MenuHeader"));
        lblHeading.Text = Titel;
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public static void ShowTitel(string pTitel) { Titel = pTitel; }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public string getPageName() 
    { 
        string QS = "";
        System.IO.FileInfo PageFileInfo = new System.IO.FileInfo(Request.Url.AbsolutePath);
        if (Request.QueryString.Count != 0) { QS = "?" + Request.QueryString.ToString(); }
        return PageFileInfo.Name + QS;
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
    protected void OnMenuItemDataBound(object sender, MenuEventArgs e)
    {
        if (SiteMap.CurrentNode != null)
        {
            if (e.Item.Text == SiteMap.CurrentNode.Title)
            {
                if (e.Item.Parent != null) { e.Item.Parent.Selected = true; }
                else { e.Item.Selected = true; }
            }
        }
    }
    //public static string PageName() 
    //{ 

    //    return getPageName();
    //}
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
    protected void lnkChangePassword_Click(object sender, EventArgs e)
    {
        Server.Transfer(@"~/Pages/ChangePass.aspx");
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
    protected void lnkLogout_Click(object sender, EventArgs e)
    {
        Session["Permissions"] = null;
        Session.Contents.RemoveAll();
        Session.Abandon();
        Response.Redirect(@"~/Login.aspx");
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
    protected void lnkChangeLang_Click(object sender, EventArgs e)
    {
        if (Session["Language"].ToString() == "Ar") { Session["Language"] = "En"; } else { Session["Language"] = "Ar"; }

        if (Session["Language"].ToString() == "Ar") { Session["MyTheme"] = "ThemeAr"; }
        if (Session["Language"].ToString() == "En") { Session["MyTheme"] = "ThemeEn"; }

        AppPro.UsrLoginID = FormSession.LoginID;
        AppPro.UsrLanguage = Session["Language"].ToString();
        AppPro.TransactionBy = FormSession.LoginID;
        AppSql.UpdateLanguage(AppPro);

        Server.Transfer(Request.FilePath);
    }
}
